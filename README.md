# 操作系统模拟系统 (OS Simulation)

大三操作系统课程设计项目

## 1. 项目简介

本项目是一个基于 C++ 开发的操作系统核心功能模拟系统。系统采用模块化设计，模拟了现代操作系统的核心组件，包括进程调度、内存管理、文件系统、进程同步、进程通信（IPC）以及死锁处理机制。

系统通过一个命令行 Shell 界面与用户交互，支持用户输入命令来创建进程、申请资源、执行调度、管理文件等，能够直观地展示操作系统内部的运行机制。

## 2. 核心功能特性

### 2.1 进程管理与调度 (Scheduler)
- **进程控制**：支持进程的创建、终止、阻塞、唤醒，以及**挂起 (Suspend)** 与 **激活 (Activate)** 操作。
- **线程机制**：实现了用户级线程模型。支持为进程创建多个线程 (`TCB`)，并在进程获得 CPU 时间片时在内部进行线程轮转。
- **调度算法**：实现了 **多级反馈队列 (MLFQ)** 调度算法。
  - 包含 3 级优先级队列，时间片分别为 1, 2, 4。
  - 支持抢占式调度：高优先级进程到达时抢占 CPU。
  - 动态优先级调整：时间片用完后进程降级。

### 2.2 内存管理 (Memory Manager)
- **分配策略**：模拟 1024 个单元的物理内存池，采用 **首次适应算法 (First Fit)** 进行连续内存分配。
- **交换技术 (Swapping)**：结合进程挂起功能，实现了内存的换入换出机制。
  - `suspend`：将进程内存数据换出到外存（模拟释放内存）。
  - `activate`：重新申请内存并将进程换入。

### 2.3 死锁处理 (Deadlock Handling)
- **银行家算法**：实现了完整的死锁避免机制。
  - 支持系统资源初始化 (`init_res`)。
  - 支持进程声明最大资源需求 (`claim`)。
  - 在进程申请资源 (`req`) 时进行安全性检查，若系统不安全则拒绝分配，防止死锁。

### 2.4 进程同步与通信
- **同步互斥**：实现了 **信号量 (Semaphore)** 机制，支持 P (Wait) / V (Signal) 操作，解决临界区互斥问题。
- **进程通信 (IPC)**：实现了基于 **消息队列** 的通信机制，支持进程间发送和接收消息。

### 2.5 存储管理 (Storage)
- **文件系统**：模拟了扁平化文件系统，支持文件的创建 (`touch`)、删除 (`rm`)、读写和查看 (`ls`)。
- **持久化**：支持将虚拟磁盘状态保存到本地文件 (`os_disk.data`)，并在系统启动时自动加载。
- **程序加载**：支持 `exec` 命令加载虚拟磁盘中的文件作为进程运行。

## 3. 开发团队与分工

本项目由小组成员协作完成，具体分工如下：

* **沈卓**：负责 **进程调度模块 (Scheduler)**
    * 实现 PCB/TCB 结构、MLFQ 调度算法、银行家算法及死锁避免逻辑。
* **孙煜彬**：负责 **内存管理模块 (Memory Manager)**
    * 实现内存池管理、首次适应分配算法、内存回收及换入换出逻辑。
* **许欣宇**：负责 **存储管理模块 (Storage)**
    * 实现虚拟文件系统、文件增删改查操作及磁盘数据的持久化存储。
* **黄海喆**：负责 **同步与通信模块 (Sync/IPC)**
    * 实现信号量机制 (PV操作) 及 消息队列通信机制。

所有模块通过 `main.cpp` 统一整合，形成完整的模拟系统。

## 4. 快速开始

### 编译环境
- 编译器：支持 C++17 标准 (GCC/Clang/MSVC)
- 构建工具：CMake 或直接使用 g++

### 编译运行 (命令行方式)
```bash
# 编译所有模块
g++ -std=c++17 main.cpp scheduler/*.cpp memory_manager/*.cpp storage/*.cpp ipc/*.cpp -o os-sim

# 运行
./os-sim